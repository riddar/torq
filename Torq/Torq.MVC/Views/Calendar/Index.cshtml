
@model Torq.Models.Objects.Schedule[]
@{
    ViewBag.Title = "Index";
}
@Html.Partial("_MonthPartial")


<head>

    <script src="~/Scripts/jquery-3.3.1.js"></script>
    <script>
        /*$('#sandbox-container div').datepicker({
            todayBtn: "linked",
            language: "sv",
            todayHighlight: true
        });*/
    </script>
</head>


<h2>Index</h2>
<h3></h3>
<div id="sandbox-container">
    <div>
    </div>
</div>

<input type="datetime" id="dateTimeField" />
<select id="EmployeeSelector"><option>choose</option></select>

<script>
    $(document).ready(function () {
     //   $('#dateTimeField').on('keyup', dateFilter);
        $('#EmployeeSelector').on('change', employeeFilter);
       // $('#EmployeeSelector').change(function () { console.log(this) });

        var y = JSON.parse('@Html.Raw(Json.Encode(ViewData["Employees"]))');
        var options = y;
        console.log(options);
        $('#EmployeeSelector');
        $.each(options, function (i, p) {
            $('#EmployeeSelector').append($('<option></option>').val(p).html(p.FirstName));
        });

    });

    function employeeFilter(event)
    {
        var optionSelected = $("option:selected", this);
        console.log(optionSelected[0].innerHTML);
        console.log(event);
        let sOption = optionSelected[0].innerHTML;
        console.log("denna");
        console.log(sOption + " text");

        localStorage.setItem('ChoosenEmployee', sOption);
        console.log("log 2: " + localStorage.getItem('ChoosenEmployee'));

        // Håller på
        let newArray = [];
        let innerArray = [];
        let EmployeeArray = [];

        let ii = 0;

        $(".UlKlass").empty();

        @foreach (var d in Model)
        {

        if (d.Employee != null)
        {
             @:innerArray[ii] = { Id: "@d.Employee.Id", FirstName: "@d.Employee.FirstName", LastName: "@d.Employee.LastName", IsOnline: "@d.Employee.IsOnline" };
            @:newArray[ii] = { Id: "@d.Id", ClockedIn: "@d.ClockedIn", Employee: innerArray[ii], EndTime: "@d.EndTime", StartTime: "@d.StartTime", Salary: "@d.Salary" };
            @:ii++;

         }



        }


        console.log(sOption + "soption");
        console.log('newArray', newArray);
        console.log("sträng" + newArray[0].Employee.FirstName);
        let FilterdDates = newArray.filter(obj => String(obj.Employee.FirstName).includes(sOption));
     //   let split = String(newArray[0].StartTime).split(" ");
       // document.getElementById("lemo").innerHTML = split[0];

        var Aul = document.createElement('ul');
        var Bul = document.createElement('ul');
        Bul.className = "UlKlass";
        Aul.className = "UlKlass";
        document.getElementById('AvailableDiv').appendChild(Aul);
        document.getElementById('BookedDiv').appendChild(Bul);

        console.log("här");
        for (ii = 0; ii < FilterdDates.length; ii++)
        {

            let x = document.createElement("A");
            let t = document.createTextNode("Edit");
            x.setAttribute("href", "editschedule/" + FilterdDates[ii].Id);
            x.appendChild(t);

            if (FilterdDates[ii].Employee === null) {
                let li = document.createElement('li');
                Aul.appendChild(li);
                li.innerHTML += FilterdDates[ii].StartTime + " -> " + FilterdDates[ii].EndTime + ": ";
                li.appendChild(x);
            }

            else {
                li = document.createElement('li');
                Bul.appendChild(li);
                li.innerHTML += FilterdDates[ii].Employee.FirstName + " " + FilterdDates[ii].Employee.LastName + ": " + FilterdDates[ii].StartTime + " -> " + FilterdDates[ii].EndTime + ": ";
                li.appendChild(x);
            }
        }
        //


        }

   /* function dateFilter2(MarkedDate)
    {
        console.log(MarkedDate);
    } */

    function dateFilter2(selectedDate) {
        console.log("Selected Date: " + selectedDate);
        let myArray = [];
        let newArray = [];
        let innerArray = [];
        let EmployeeArray = [];

        let ii = 0;

        $(".UlKlass").empty();

        @foreach (var d in Model)
        {
            @:console.log("Employee :" + "@d.Employee");

         @:myArray.push("@d");
         if (d.Employee != null)
         {
             @:innerArray[ii] = { Id: "@d.Employee.Id", FirstName: "@d.Employee.FirstName", LastName: "@d.Employee.LastName", IsOnline: "@d.Employee.IsOnline" };
         }
         else
         {
             @:innerArray[ii] = null;
         }

         @:newArray[ii] = { Id: "@d.Id", ClockedIn: "@d.ClockedIn", Employee: innerArray[ii], EndTime: "@d.EndTime", StartTime: "@d.StartTime", Salary: "@d.Salary" };
         @:ii++;

        }

        console.log(myArray);

        let FilterdDates = newArray.filter(obj => String(obj.StartTime).includes(selectedDate)); //dateTimeField.value
        let split = String(newArray[0].StartTime).split(" ");
       // document.getElementById("lemo").innerHTML = split[0];

        var Aul = document.createElement('ul');
        var Bul = document.createElement('ul');
        Bul.className = "UlKlass";
        Aul.className = "UlKlass";

        document.getElementById('AvailableDiv').appendChild(Aul);
        document.getElementById('BookedDiv').appendChild(Bul);


        for (ii = 0; ii < FilterdDates.length; ii++)
        {

            let x = document.createElement("A");
            let t = document.createTextNode("Edit");
            x.setAttribute("href", "editschedule/" + FilterdDates[ii].Id);
            x.appendChild(t);

            if (FilterdDates[ii].Employee === null) {
                let li = document.createElement('li');
                Aul.appendChild(li);
                li.innerHTML += FilterdDates[ii].StartTime + " -> " + FilterdDates[ii].EndTime + ": ";
                li.appendChild(x);
            }

            else {
                li = document.createElement('li');
                Bul.appendChild(li);
                li.innerHTML += FilterdDates[ii].Employee.FirstName + " " + FilterdDates[ii].Employee.LastName + ": " + FilterdDates[ii].StartTime + " -> " + FilterdDates[ii].EndTime + ": ";
                li.appendChild(x);
            }
        }
        console.log(FilterdDates.length);
    }
</script>

<p id="lemo">exempel tid</p>



<h4>Available</h4>
<div id="AvailableDiv"></div>
<ul id="myUL">
    <!--@foreach (var x in ViewBag.CalendarDataList)
        {
            if (x.Employee == null)
            {
                <li>
                    @x.Id;
                    @x.StartTime;
                    @x.EndTime;
                </li>
            }

        }-->
</ul>
<h4>Booked</h4>
<div id="BookedDiv"></div>
<ul>
    <!--   @foreach (var x in ViewBag.CalendarDataList)
    {
        if (x.Employee != null)
        {

            <li>
                @x.Employee.FirstName;
                @x.Id;
                @x.StartTime;
                @x.EndTime;
            </li>

        }
    }-->
</ul>


